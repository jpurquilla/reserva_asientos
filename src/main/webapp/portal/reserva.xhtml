<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:f="jakarta.faces.core"
                xmlns:h="jakarta.faces.html"
                template="/WEB-INF/clienteLayout/template.xhtml"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="titulo">
        Reservar
    </ui:define>
    <ui:define name="header">
        <h1>Titulo de pantalla de comprador</h1>
    </ui:define>
    <ui:define name="content">
        <h1>Resevar</h1>
        <div class="mt-2 mb-2 border-solid border-round-3xl border-1">
            <h2>
                <p>Nombre de evento</p>
            </h2>
        </div>       
        <div class="mb-2">
            <span>Ingrese cantidad de localidades a reservar</span>
            <h:form id="inputCantidadaSeleccionar">
                <p:inputNumber class="ml-4" id="cantidadAReservar" value="#{reserva.cantidadaReservar}" minValue="0" decimalPlaces="0">
                    <f:ajax event="keyup" render="asientos" execute="@this" listener="#{reserva.reestablecerSelecciones()}" />
                </p:inputNumber>
            </h:form>

            <h2>Seleccione sus asientos</h2>
            
            <h:form id="asientos" class="mx-8">
                <div class="">
                    <div style="">
                        <ui:repeat value="#{reserva.secciones}" var="seccion">                   
                            <h:outputLabel value="#{seccion.nombre}" class="block" />
                            <div class="flex flex-wrap gap-0 justify-content-center align-items-center">
                                <div class="grid grid-nogutter">
                                <ui:repeat value="#{seccion.localidades}" var="localidad" varStatus="loop">
                                    <div class="col-2">

                                        <p:commandLink class="" disabled="#{reserva.cantidadaReservar eq null or reserva.cantidadaReservar le 0}" 
                                                   style="height: 0px; #{localidad.estado ne 30} ? 'cursor: pointer;' : 'cursor: default;'}" 
                                                   styleClass="ui-icon" id="asiento">
                                            <f:ajax event="click" execute="@form" render="asientos" listener="#{reserva.changeStatus(localidad)}"/>
                                            <i class="pi pi-stop" style="font-size: 2rem; #{localidad.estado eq 20 ? 'color:aquamarine;' : localidad.estado eq 30 ? 'color:red;' : 'color:grey;'}"></i>

                                            <p:tooltip rendered="#{localidad.estado ne 30}" for="asiento" position="top">
                                                <h:outputLabel value="Local: #{localidad.localidadPK.codigo}"/>
                                            </p:tooltip>
                                            <p:tooltip rendered="#{localidad.estado eq 30}" for="asiento" position="top">
                                                <h:outputLabel value="No disponible"/>
                                            </p:tooltip>  
                                            <p:tooltip rendered="#{reserva.localidadesSeleccionadas.size() ge reserva.cantidadaReservar}" for="asiento" position="top">
                                                <h:outputLabel  value="Límite máximo de asientos alcanzado"/>
                                            </p:tooltip>  

                                        </p:commandLink>   

                                    </div>
                                </ui:repeat>
                                </div>
                            </div>        
                            <p:divider />                            
                        </ui:repeat>                        
                    </div>
               
                </div>
                <div class="flex align-items-center justify-content-center">
                        <p:sidebar widgetVar="pagosidebar" style="overflow:scroll;" position="right">
                            <p:accordionPanel widgetVar="basic" activeIndex="-1">
                                <p:tab title="Ver detalles">
                                    <div class="mt-2 mb-2">
                                        <ui:repeat value="#{reserva.localidadesSeleccionadas}" var="localidadS">
                                            <p:card class="bg-gray-100 py-0">

                                                <h:outputText value="Localidad: "/><p:tag style="float: right;" styleClass="mr-2" value="#{localidadS.localidadPK.codigo}"></p:tag>
                                                <br/>
                                                <br/>
                                                <h:outputText  class="mt-2" value="Precio: "/><p:tag styleClass="mr-2" style="float: right;" severity="warning" value="$ #{reserva.getPrecioSeccion(localidadS)}"></p:tag>
                                            </p:card>
                                        </ui:repeat>
                                    </div>
                                </p:tab>
                            </p:accordionPanel>

                            <p:card class="mt-4">
                                    <h:outputText value="Subtotal: " class=""/><p:tag styleClass="mr-2" style="float: right;" severity="warning" value="$ #{reserva.subtotal}"></p:tag>    
                            </p:card>
                            
                            <div class="mt-2">
                                <div class="field col-12">
                                    <p:commandButton disabled="#{empty reserva.localidadesSeleccionadas}" 
                                                     value="Proceder al pago" styleClass="ui-button-success ml-6 mt-4"
                                                     action="#{reserva.confirmarPago()}"/>      
                                </div>
                                
                            </div>
                        </p:sidebar>
                        <p:commandButton icon="pi pi-check" type="button" styleClass="ui-button-success mr-2" value="Confirmar reserva" onclick="PF('pagosidebar').show()"/>                     
                        <p:commandButton style="float:right;" styleClass="ui-button-secondary" icon="pi pi-undo" value="Restablecer" action="#{reserva.reestablecerSelecciones()}" process="@form" update="asientos"/>                    
                </div>
  
                



            </h:form>

        </div>

    </ui:define>
</ui:composition>
